<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人中心</title>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-md-4">
        </div>
        <div class="col-md-4 lead">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title lead">个人中心</h3>
                </div>
                <div class="panel-body">
                    <div class="well text-center">
                        <div>
                            今日持咒：
                            <strong class="text-danger">{$todayNum}</strong>
                        </div>
                        <if condition="$user['day_goal'] neq null">
                            <div>
                                今日目标：
                                <strong class="text-primary">{$user.day_goal}&nbsp;&nbsp;</strong>
                            </div>
                            <div>
                                完成度：
                                <strong class="text-success">{$dayGoalPercent}</strong>
                            </div>
                        </if>
                        <div>
                            持咒总数：
                            <strong class="text-danger">{$user.total}</strong>
                        </div>
                        <if condition="$user['goal'] neq null">
                            <div>
                                发愿目标：
                                <strong class="text-primary">{$user.goal}&nbsp;&nbsp;</strong>
                            </div>
                            <div>
                                完成度：
                                <strong class="text-success">{$totalGoalPercent}</strong>
                            </div>
                        </if>
                    </div>
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-4 control-label">用户昵称</label>
                            <div class="col-sm-8">
                                <label>{$user.username}</label>
                                <input type="hidden" name="id" value="{$user.id}"/>
                                <input type="hidden" name="username" id="username" value="{$user.username}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">真实姓名</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="realname" id="realname" placeholder="真实姓名" value="{$user.realname}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">你的法名</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="dharma" id="dharma" placeholder="法名（限灌顶弟子填写）" value="{$user.dharma}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">每日目标</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="day_goal" id="day_goal" placeholder="每日计划数目(可不填写）" value="{$user.day_goal}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">发愿目标</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="goal" id="goal" placeholder="发愿完成总数(可不填写）" value="{$user.goal}"/>
                            </div>
                        </div>
                        <div class="form-group text-center">
                            <button type="button" class="btn btn-danger" onclick="updateUserInfo()">
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                保存信息
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            </button>
                        </div>
                        <div class="form-group text-center">
                            <button type="button" class="btn btn-default" onclick="modifyPassword()">
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                修改密码
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            </button>
                        </div>
                        <div class="form-group text-center">
                            <button type="button" class="btn btn-default" onclick="logout()">
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                退出登录
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
        </div>
    </div>
</div>

<script src="__PUBLIC__/lib/jquery-1.7.2.min.js"></script>
<script src="__PUBLIC__/lib/layer/layer.js"></script>
<script src="__PUBLIC__/js/common/dialog.js"></script>
<script src="__PUBLIC__/js/common/ajax.js"></script>
<script type="text/javascript">

    function modifyPassword(){
        window.location.href="{:U('Login/modifyPassword', array('username'=>$user['username']))}";
    }

    function logout(){
        dialog.confirm("确定要退出登录?","{:U('Login/logout')}");
    }

    function updateUserInfo(){
        id = '{$user.id}';
        username = $('#username').val();
        realname = $('#realname').val();
        dharma = $('#dharma').val();
        goal = $('#goal').val();
        day_goal = $('#day_goal').val();
        var aj = $.ajax({
            url: "{:U('Api/User/updateUserInfo')}",
            data: {
                id:id,
                username:username,
                realname:realname,
                dharma:dharma,
                goal:goal,
                day_goal:day_goal
            },
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function (data) {
                if( data.error_code ){
                    dialog.error(data.msg);
                }else{
                    dialog.success("保存成功!","{:U('Login/userCenter')}");
                }
            },
            error: function () {
                alert("异常！");
            }
        });
    }

</script>

</body>
</html>